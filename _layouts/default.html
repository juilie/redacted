<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Begin Jekyll SEO tag v2.8.0 -->
  <meta name="generator" content="Jekyll v4.3.3" />
  <meta property="og:title" content="{{ page.title | escape }}" />
  <meta property="og:locale" content="en_US" />
  <meta name="description" content="{{ page.description | default: site.description | escape }}" />
  <meta property="og:description" content="{{ page.description | default: site.description | escape }}" />
  <link rel="canonical" href="{{ page.url | absolute_url }}" />
  <meta property="og:url" content="{{ page.url | absolute_url }}" />
  <meta property="og:site_name" content="{{ site.title | escape }}" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary" />
  <meta property="twitter:title" content="{{ page.title | escape }}" />
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "description": "{{ page.description | default: site.description | escape }}",
      "headline": "{{ page.title | escape }}",
      "name": "{{ site.title | escape }}",
      "url": "{{ page.url | absolute_url }}"
    }
  </script>
  <!-- End Jekyll SEO tag -->

  <!-- <link rel="stylesheet" href="/static/css/default.css"> -->
  <link type="application/atom+xml" rel="alternate" href="{{ "/feed.xml" | absolute_url }}" title="{{ site.title }}" />

  <title>「Redacted」- {{ page.title }}</title>
  <link rel="icon" type="image/png" href="/static/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/android-chrome-512x512.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/favicon-16x16.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/android-chrome-512x512.png">
  <link rel="icon" type="image/png" href="/static/images/favicon/apple-touch-icon.png">
  <link rel="stylesheet" href="{{ '/static/css/default.css' | relative_url }}">
  <!-- Page-specific CSS -->
  {% if page.css %}
  <link rel="stylesheet" href="{{ page.css | relative_url }}">
  {% endif %}
</head>

<body>
  <div class="image-background">
    <video id="background-video" autoplay loop muted playsinline webkit-playsinline preload="auto">
        <!-- H.264 MP4 for Safari/iOS compatibility (must be H.264, not VP9) -->
        <source src="/static/videos/mirror3.mp4" type="video/mp4;">
        <!-- Fallback MP4 -->
        <!-- <source src="/static/videos/mirror.mp4" type="video/mp4"> -->
         <!-- <source src="/static/videos/redacted.webm" type="video/webm;"> -->
    </video>
  </div>
  <svg class="filter" id="filter" style="display: none;">
    <svg width="250" height="250">
  
      <filter id='noise' x='0%' y='0%' width='100%' height='100%'>
          <feTurbulence baseFrequency="0.03" type="turbulence" />
    </filter>
      
      <rect x="0" y="0" width="100%" height="100%" filter="url(#noise)" fill="none"></rect>
        
  </svg>
  <script>
    (function() {
      // Ensure video autoplays on iOS Safari
      const video = document.getElementById('background-video');
      if (video) {
        video.muted = true;
        video.setAttribute('playsinline', '');
        video.setAttribute('webkit-playsinline', '');
        
        // Force play on iOS Safari
        const playPromise = video.play();
        if (playPromise !== undefined) {
          playPromise.catch(error => {
            // If autoplay fails, try again after user interaction
            document.addEventListener('touchstart', function playVideo() {
              video.play().catch(() => {});
              document.removeEventListener('touchstart', playVideo);
            }, { once: true });
          });
        }
        
        // Ensure video loops
        video.addEventListener('ended', function() {
          video.currentTime = 0;
          video.play();
        });
      }
    })();
  </script>
  <div class="marquee">
    <div class="marquee-content">
        {% assign settings_file = site.pages | where: "path", "settings.md" | first %}
        {% assign marquee_text = settings_file.marquee_text | default: site.marquee_text | default: "REDACTED" %}
        {% assign marquee_processed = marquee_text | markdownify | strip_html %}
        {% for i in (1..10) %}
        <span>{{ marquee_text | markdownify }}</span>
        {% endfor %}
    </div>
    <div class="marquee-content" aria-hidden="true">
        {% for i in (1..10) %}
        <span>{{ marquee_text | markdownify }}</span>
        {% endfor %}
    </div>
  </div>
  {% unless page.url == '/' or page.url == '/index.html' %}
  <nav class="site-nav-bar">
    <a href="/" class="site-brand">「Redacted」</a>
    <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">Menu</button>
    <div class="site-nav-links">
      <a href="/works">Works</a>
      <a href="/performances">Performances</a>
      <a href="/press">Press</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
    </div>
  </nav>
  <script>
    (function() {
      const toggle = document.querySelector('.nav-toggle');
      const nav = document.querySelector('.site-nav-bar');
      if (toggle && nav) {
        toggle.addEventListener('click', () => {
          const isOpen = nav.classList.toggle('nav-open');
          toggle.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
          toggle.textContent = isOpen ? 'Close' : 'Menu';
        });
      }
    })();
  </script>
  {% endunless %}

  {% assign settings_file = site.pages | where: "path", "settings.md" | first %}
  {% if settings_file.modal_enabled and settings_file.modal_content and settings_file.modal_content != "" %}
  <!-- Site Modal -->
  <div class="site-modal" id="site-modal">
    <div class="site-modal-overlay"></div>
    <div class="site-modal-content">
      <button class="site-modal-close" id="site-modal-close" aria-label="Close modal">&times;</button>
      {% if settings_file.modal_title and settings_file.modal_title != "" %}
      <h2 class="site-modal-title">{{ settings_file.modal_title }}</h2>
      {% endif %}
      <div class="site-modal-body">
        {{ settings_file.modal_content | markdownify }}
      </div>
      {% if settings_file.modal_link and settings_file.modal_link != "" %}
      <div class="site-modal-footer">
        <a href="{{ settings_file.modal_link }}" class="site-modal-button">{{ settings_file.modal_link_text | default: "Learn More" }}</a>
      </div>
      {% endif %}
    </div>
  </div>

  <script>
    (function() {
      const modal = document.getElementById('site-modal');
      const closeBtn = document.getElementById('site-modal-close');
      
      if (!modal) return;

      // Check if modal was already dismissed (persists for 7 days)
      const modalDismissed = localStorage.getItem('site-modal-dismissed');
      if (modalDismissed) {
        const dismissedTime = parseInt(modalDismissed, 10);
        const now = Date.now();
        const sevenDays = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds
        
        // If dismissed less than 7 days ago, don't show
        if (now - dismissedTime < sevenDays) {
          modal.style.display = 'none';
          return;
        } else {
          // Expired, clear it
          localStorage.removeItem('site-modal-dismissed');
        }
      }

      // Show modal after a short delay
      setTimeout(function() {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
      }, 500);

      function closeModal() {
        modal.classList.remove('active');
        document.body.style.overflow = '';
        // Store current timestamp
        localStorage.setItem('site-modal-dismissed', Date.now().toString());
      }

      if (closeBtn) {
        closeBtn.addEventListener('click', closeModal);
      }

      // Close on overlay click
      const overlay = modal.querySelector('.site-modal-overlay');
      if (overlay) {
        overlay.addEventListener('click', closeModal);
      }

      // Close on Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
          closeModal();
        }
      });
    })();
  </script>
  {% endif %}

  <main>
    {{ content }}
  </main>
</body>

</html>